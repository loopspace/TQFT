\documentclass{standalone}
\usepackage{tikz}
\makeatletter

\newdimen\pgf@tqft@north
\newdimen\pgf@tqft@south
\newdimen\pgf@tqft@east
\newdimen\pgf@tqft@west
\newdimen\pgf@tqft@midx
\newdimen\pgf@tqft@midy
\newdimen\pgf@tqft@ctrla
\newdimen\pgf@tqft@ctrlb

\pgfkeyssetvalue{/pgf/tqft cobordism height}{2cm}
\pgfkeyssetvalue{/pgf/tqft boundary separation}{2cm}
\pgfkeyssetvalue{/pgf/tqft circle width}{10pt}
\pgfkeyssetvalue{/pgf/tqft circle depth}{5pt}
\pgfkeyssetvalue{/pgf/tqft flow}{south}

% The direction of the flow sets up a transformation to be applied to
% the node shapes; this complicates the anchors a little as they look
% different from the inside and the outside
\def\pgf@tqft@flow@south{}
\def\pgf@tqft@flow@north{\pgftransformxscale{-1}\pgftransformrotate{180}}
\def\pgf@tqft@flow@east{\pgftransformyscale{-1}\pgftransformrotate{90}}
\def\pgf@tqft@flow@west{\pgftransformrotate{270}}

\pgfdeclareshape{pair of pants}
{
  % location of boundary components as seen from inside
  \savedanchor{\int@inbdry}{%
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@outbdrya}{%
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=-.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@outbdryb}{%
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }

  % location of boundary components as seen from outside
  % same as inside except that we apply the ``flow transformation''
  % we save them as the ``flow transformation'' might change between
  % the node's use and the anchors' use
  \savedanchor{\ext@inbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@outbdrya}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=-.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@outbdryb}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
    
  % Externally available anchors
  \anchor{centre}{\pgfpointorigin}
  \anchor{center}{\pgfpointorigin}
  \anchor{incoming boundary}{\ext@inbdry}
  \anchor{outgoing boundary 1}{\ext@outbdrya}
  \anchor{outgoing boundary 2}{\ext@outbdryb}


  % background path
  \backgroundpath{
    % find out our desired size
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    % figure out our coordinates, using the internal anchors
    \int@inbdry \pgf@tqft@north=\pgf@y
    \int@outbdrya \pgf@tqft@west=\pgf@x \pgf@tqft@south=\pgf@y
    \int@outbdryb \pgf@tqft@east=\pgf@x
    \pgf@tqft@midx=.5\pgf@tqft@east
    \advance\pgf@tqft@midx by .5\pgf@tqft@west
    \pgf@tqft@midy=.5\pgf@tqft@north
    \advance\pgf@tqft@midy by .5\pgf@tqft@south
    % translate our origin to the centre of the node
    \advance\pgf@tqft@east by -\pgf@tqft@midx
    \advance\pgf@tqft@west by -\pgf@tqft@midx
    \advance\pgf@tqft@north by -\pgf@tqft@midy
    \advance\pgf@tqft@south by -\pgf@tqft@midy
    \pgf@tqft@midx=0pt
    \pgf@tqft@midy=0pt
    % translate our origin to the centre of the node
%    \pgftransformshift{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@midy}}
    % apply the flow transformation
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    % translate our origin back again
%    \pgftransformshift{\pgfqpoint{-\pgf@tqft@midx}{-\pgf@tqft@midy}}
    
    % draw the boundary components
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@midx}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@east}{\the\pgf@tqft@south}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@west}{\the\pgf@tqft@south}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}

    % draw the cobordism
    \advance\pgf@tqft@midx by -\pgfutil@tempdima
    \pgf@tqft@ctrla=\pgf@tqft@north
    \advance\pgf@tqft@ctrla by -4\pgfutil@tempdimb
    \advance\pgf@tqft@west by -\pgfutil@tempdima
    \pgf@tqft@ctrlb=\pgf@tqft@south
    \advance\pgf@tqft@ctrlb by 4\pgfutil@tempdimb
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@south}}
    \advance\pgf@tqft@east by \pgfutil@tempdima
    \advance\pgf@tqft@midx by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@south}}
    \advance\pgf@tqft@east by -2\pgfutil@tempdima
    \advance\pgf@tqft@west by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@south}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@south}}
  }
}

\pgfdeclareshape{reverse pair of pants}
{
  % location of boundary components as seen from inside
  \savedanchor{\int@outbdry}{%
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@inbdrya}{%
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=-.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@inbdryb}{%
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }

  % location of boundary components as seen from outside
  % same as inside except that we apply the ``flow transformation''
  % we save them as the ``flow transformation'' might change between
  % the node's use and the anchors' use
  \savedanchor{\ext@outbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@inbdrya}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=-.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@inbdryb}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
    
  % Externally available anchors
  \anchor{centre}{\pgfpointorigin}
  \anchor{center}{\pgfpointorigin}
  \anchor{outgoing boundary}{\ext@outbdry}
  \anchor{incoming boundary 1}{\ext@inbdrya}
  \anchor{incoming boundary 2}{\ext@inbdryb}


  % background path
  \backgroundpath{
    % find out our desired size
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    % figure out our coordinates, using the internal anchors
    \int@outbdry \pgf@tqft@south=\pgf@y
    \int@inbdrya \pgf@tqft@west=\pgf@x \pgf@tqft@north=\pgf@y
    \int@inbdryb \pgf@tqft@east=\pgf@x
    \pgf@tqft@midx=.5\pgf@tqft@east
    \advance\pgf@tqft@midx by .5\pgf@tqft@west
    \pgf@tqft@midy=.5\pgf@tqft@north
    \advance\pgf@tqft@midy by .5\pgf@tqft@south
    % translate our origin to the centre of the node
    \advance\pgf@tqft@east by -\pgf@tqft@midx
    \advance\pgf@tqft@west by -\pgf@tqft@midx
    \advance\pgf@tqft@north by -\pgf@tqft@midy
    \advance\pgf@tqft@south by -\pgf@tqft@midy
    \pgf@tqft@midx=0pt
    \pgf@tqft@midy=0pt
    % translate our origin to the centre of the node
%    \pgftransformshift{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@midy}}
    % apply the flow transformation
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    % translate our origin back again
%    \pgftransformshift{\pgfqpoint{-\pgf@tqft@midx}{-\pgf@tqft@midy}}
    
    % draw the boundary components
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@midx}{\the\pgf@tqft@south}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@east}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@west}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}

    % draw the cobordism
    \advance\pgf@tqft@midx by -\pgfutil@tempdima
    \pgf@tqft@ctrla=\pgf@tqft@south
    \advance\pgf@tqft@ctrla by 4\pgfutil@tempdimb
    \advance\pgf@tqft@west by -\pgfutil@tempdima
    \pgf@tqft@ctrlb=\pgf@tqft@north
    \advance\pgf@tqft@ctrlb by -4\pgfutil@tempdimb
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@south}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@north}}
    \advance\pgf@tqft@east by \pgfutil@tempdima
    \advance\pgf@tqft@midx by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@south}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@north}}
    \advance\pgf@tqft@east by -2\pgfutil@tempdima
    \advance\pgf@tqft@west by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@north}}
  }
}


\pgfdeclareshape{cylinder to prior}
{
  % location of boundary components as seen from inside
  \savedanchor{\int@inbdry}{%
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@outbdry}{%
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=-.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }

  % location of boundary components as seen from outside
  % same as inside except that we apply the ``flow transformation''
  % we save them as the ``flow transformation'' might change between
  % the node's use and the anchors' use
  \savedanchor{\ext@inbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@outbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=-.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
    
  % Externally available anchors
  \anchor{centre}{\pgfpointorigin}
  \anchor{center}{\pgfpointorigin}
  \anchor{incoming boundary}{\ext@inbdry}
  \anchor{outgoing boundary}{\ext@outbdry}


  % background path
  \backgroundpath{
    % find out our desired size
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    % figure out our coordinates, using the internal anchors
    \int@inbdry \pgf@tqft@north=\pgf@y \pgf@tqft@midx=\pgf@x
    \int@outbdry \pgf@tqft@west=\pgf@x \pgf@tqft@south=\pgf@y
    \pgf@tqft@midy=.5\pgf@tqft@north
    \advance\pgf@tqft@midy by .5\pgf@tqft@south
    % translate our origin to the centre of the node
    \advance\pgf@tqft@west by -\pgf@tqft@midx
    \advance\pgf@tqft@north by -\pgf@tqft@midy
    \advance\pgf@tqft@south by -\pgf@tqft@midy
    \pgf@tqft@midx=0pt
    \pgf@tqft@midy=0pt
    % translate our origin to the centre of the node
%    \pgftransformshift{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@midy}}
    % apply the flow transformation
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    % translate our origin back again
%    \pgftransformshift{\pgfqpoint{-\pgf@tqft@midx}{-\pgf@tqft@midy}}
    
    % draw the boundary components
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@midx}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@west}{\the\pgf@tqft@south}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}

    % draw the cobordism
    \advance\pgf@tqft@midx by -\pgfutil@tempdima
    \pgf@tqft@ctrla=\pgf@tqft@north
    \advance\pgf@tqft@ctrla by -4\pgfutil@tempdimb
    \advance\pgf@tqft@west by -\pgfutil@tempdima
    \pgf@tqft@ctrlb=\pgf@tqft@south
    \advance\pgf@tqft@ctrlb by 4\pgfutil@tempdimb
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@south}}
    \advance\pgf@tqft@midx by 2\pgfutil@tempdima
    \advance\pgf@tqft@west by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@south}}
  }
}

\pgfdeclareshape{cylinder to next}
{
  % location of boundary components as seen from inside
  \savedanchor{\int@inbdry}{%
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@outbdry}{%
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }

  % location of boundary components as seen from outside
  % same as inside except that we apply the ``flow transformation''
  % we save them as the ``flow transformation'' might change between
  % the node's use and the anchors' use
  \savedanchor{\ext@inbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@outbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgf@xa=\pgfkeysvalueof{/pgf/tqft boundary separation}
    \pgf@xa=.5\pgf@xa
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
    
  % Externally available anchors
  \anchor{centre}{\pgfpointorigin}
  \anchor{center}{\pgfpointorigin}
  \anchor{incoming boundary}{\ext@inbdry}
  \anchor{outgoing boundary}{\ext@outbdry}


  % background path
  \backgroundpath{
    % find out our desired size
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    % figure out our coordinates, using the internal anchors
    \int@inbdry \pgf@tqft@north=\pgf@y \pgf@tqft@midx=\pgf@x
    \int@outbdry \pgf@tqft@west=\pgf@x \pgf@tqft@south=\pgf@y
    \pgf@tqft@midy=.5\pgf@tqft@north
    \advance\pgf@tqft@midy by .5\pgf@tqft@south
    % translate our origin to the centre of the node
    \advance\pgf@tqft@west by -\pgf@tqft@midx
    \advance\pgf@tqft@north by -\pgf@tqft@midy
    \advance\pgf@tqft@south by -\pgf@tqft@midy
    \pgf@tqft@midx=0pt
    \pgf@tqft@midy=0pt
    % translate our origin to the centre of the node
%    \pgftransformshift{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@midy}}
    % apply the flow transformation
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    % translate our origin back again
%    \pgftransformshift{\pgfqpoint{-\pgf@tqft@midx}{-\pgf@tqft@midy}}
    
    % draw the boundary components
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@midx}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@west}{\the\pgf@tqft@south}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}

    % draw the cobordism
    \advance\pgf@tqft@midx by -\pgfutil@tempdima
    \pgf@tqft@ctrla=\pgf@tqft@north
    \advance\pgf@tqft@ctrla by -4\pgfutil@tempdimb
    \advance\pgf@tqft@west by -\pgfutil@tempdima
    \pgf@tqft@ctrlb=\pgf@tqft@south
    \advance\pgf@tqft@ctrlb by 4\pgfutil@tempdimb
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@south}}
    \advance\pgf@tqft@midx by 2\pgfutil@tempdima
    \advance\pgf@tqft@west by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrlb}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@south}}
  }
}


\pgfdeclareshape{tqft cylinder}
{
  % location of boundary components as seen from inside
  \savedanchor{\int@inbdry}{%
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }
  \savedanchor{\int@outbdry}{%
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
  }

  % location of boundary components as seen from outside
  % same as inside except that we apply the ``flow transformation''
  % we save them as the ``flow transformation'' might change between
  % the node's use and the anchors' use
  \savedanchor{\ext@inbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
  \savedanchor{\ext@outbdry}{%
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgf@y
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@tqft@midx}{\pgf@tqft@x}
    \setlength{\pgf@tqft@midy}{\pgf@tqft@y}
    \pgfpointorigin
    \pgf@xa=\pgf@x
    \pgf@ya=\pgfkeysvalueof{/pgf/tqft cobordism height}
    \pgf@ya=-.5\pgf@ya
    \pgfmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfgetlastxy{\pgf@tqft@x}{\pgf@tqft@y}
    \setlength{\pgf@x}{\pgf@tqft@x}
    \setlength{\pgf@y}{\pgf@tqft@y}
    \advance\pgf@x by -\pgf@tqft@midx
    \advance\pgf@y by -\pgf@tqft@midy
  }
    
  % Externally available anchors
  \anchor{centre}{\pgfpointorigin}
  \anchor{center}{\pgfpointorigin}
  \anchor{incoming boundary}{\ext@inbdry}
  \anchor{outgoing boundary}{\ext@outbdry}


  % background path
  \backgroundpath{
    % find out our desired size
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    % figure out our coordinates, using the internal anchors
    \int@inbdry \pgf@tqft@north=\pgf@y \pgf@tqft@midx=\pgf@x
    \int@outbdry \pgf@tqft@south=\pgf@y
    \pgf@tqft@midy=.5\pgf@tqft@north
    \advance\pgf@tqft@midy by .5\pgf@tqft@south
    % translate our origin to the centre of the node
    \advance\pgf@tqft@north by -\pgf@tqft@midy
    \advance\pgf@tqft@south by -\pgf@tqft@midy
    \pgf@tqft@midx=0pt
    \pgf@tqft@midy=0pt
    % translate our origin to the centre of the node
%    \pgftransformshift{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@midy}}
    % apply the flow transformation
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
    % translate our origin back again
%    \pgftransformshift{\pgfqpoint{-\pgf@tqft@midx}{-\pgf@tqft@midy}}
    
    % draw the boundary components
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@midx}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@midx}{\the\pgf@tqft@south}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}

    % draw the cobordism
    \advance\pgf@tqft@midx by -\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgflineto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@south}}
    \advance\pgf@tqft@midx by 2\pgfutil@tempdima
    \pgfmoveto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@north}}
    \pgflineto{\pgfqpoint{\pgf@tqft@midx}{\pgf@tqft@south}}
  }
}


\pgfdeclareshape{tqft cap}
{
  \savedanchor\centrepoint{
    \pgf@x=0pt
    \pgf@y=0pt
  }
  \anchor{centre}{\centrepoint}
  \anchor{center}{\centrepoint}
  \backgroundpath{
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    \centrepoint \pgf@tqft@east=\pgf@x \pgf@tqft@west=\pgf@x \pgf@tqft@north=\pgf@y
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@east}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
    \advance\pgf@tqft@east by -\pgfutil@tempdima
    \advance\pgf@tqft@west by \pgfutil@tempdima
    \pgf@tqft@ctrla=\pgf@tqft@north
    \advance\pgf@tqft@ctrla by 4\pgfutil@tempdimb
    \pgfmoveto{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@north}}
  }
}

\pgfdeclareshape{tqft cup}
{
  \savedanchor\centrepoint{
    \pgf@x=0pt
    \pgf@y=0pt
  }
  \anchor{centre}{\centrepoint}
  \anchor{center}{\centrepoint}
  \backgroundpath{
    \pgfmathsetlength{\pgfutil@tempdima}{\pgfkeysvalueof{/pgf/tqft circle width}}
    \pgfmathsetlength{\pgfutil@tempdimb}{\pgfkeysvalueof{/pgf/tqft circle depth}}
    \centrepoint \pgf@tqft@east=\pgf@x \pgf@tqft@west=\pgf@x \pgf@tqft@north=\pgf@y
    \csname pgf@tqft@flow@\pgfkeysvalueof{/pgf/tqft flow}\endcsname
   \pgfpathellipse{\pgfqpoint{\the\pgf@tqft@east}{\the\pgf@tqft@north}}{\pgfqpoint{\pgfutil@tempdima}{0pt}}{\pgfqpoint{0pt}{\pgfutil@tempdimb}}
    \advance\pgf@tqft@east by -\pgfutil@tempdima
    \advance\pgf@tqft@west by \pgfutil@tempdima
    \pgf@tqft@ctrla=\pgf@tqft@north
    \advance\pgf@tqft@ctrla by -4\pgfutil@tempdimb
    \pgfmoveto{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@north}}
    \pgfpathcurveto{\pgfqpoint{\pgf@tqft@east}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@ctrla}}{\pgfqpoint{\pgf@tqft@west}{\pgf@tqft@north}}
  }
}

\makeatother
\begin{document}
\begin{tikzpicture}[tqft flow=east]
\node[pair of pants,draw] (a) {};
\node[reverse pair of pants,draw,anchor=incoming boundary 1] (b) at (a.outgoing boundary 2) {};
\node[cylinder to next,draw,anchor=incoming boundary] (c) at (a.outgoing boundary 1) {};
\node[cylinder to next,draw,anchor=outgoing boundary] (e) at (b.incoming boundary 2) {};
\path (b.outgoing boundary) ++(1.5,1) node[font=\Huge] {\(=\)};
\path (b.outgoing boundary) ++(3,0) node[reverse pair of pants,draw,anchor=incoming boundary 2] (e) {};
\node[pair of pants,draw,anchor=incoming boundary] (f) at (e.outgoing boundary) {};
\end{tikzpicture}
\end{document}